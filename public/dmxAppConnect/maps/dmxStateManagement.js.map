{"version":3,"sources":["components/queryManager.js","components/cookieManager.js","components/localManager.js","components/sessionManager.js"],"names":["dmx","Component","initialData","data","attributes","methods","set","key","value","this","setQueryParam","remove","removeAll","render","node","update","parseQuery","window","location","search","updated","URLSearchParams","url","URL","history","pushState","pathname","buildQuery","hash","requestUpdate","keys","Object","length","reduce","query","encodeURIComponent","replace","split","part","p","decodeURIComponent","name","options","setCookie","expires","forEach","cookie","document","pos","indexOf","substr","test","path","String","escape","Date","now","toUTCString","domain","secure","val","JSON","stringify","localStorage","setItem","removeItem","getData","startsWith","parse","getItem","e","console","warn","sessionStorage"],"mappings":"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","file":"../dmxStateManagement/dmxStateManagement.js","sourcesContent":["dmx.Component('query-manager', {\r\n\r\n    initialData: {\r\n        data: {}\r\n    },\r\n\r\n    attributes: {},\r\n\r\n    methods: {\r\n        set: function(key, value) {\r\n            this.setQueryParam(key, value);\r\n        },\r\n\r\n        remove: function(key) {\r\n            this.setQueryParam(key);\r\n        },\r\n\r\n        removeAll: function() {\r\n            this.setQueryParam();\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.update();\r\n    },\r\n\r\n    update: function() {\r\n        this.set('data', this.parseQuery(window.location.search));\r\n    },\r\n\r\n    setQueryParam: function(key, value) {\r\n        var updated = false;\r\n\r\n        if (value == null) {\r\n            if (key == null) {\r\n                this.data.data = {};\r\n                updated = true;\r\n            } else if (this.data.data[key]) {\r\n                delete this.data.data[key];\r\n                updated = true;\r\n            }\r\n        } else if (this.data.data[key] != value) {\r\n            this.data.data[key] = value;\r\n            updated = true;\r\n        }\r\n\r\n        if (updated) {\r\n            if (window.URLSearchParams) { // use URLSearchParams if available\r\n                var url = new URL(window.location);\r\n                url.search = new URLSearchParams(this.data.data);\r\n                window.history.pushState(null, null, url);\r\n            } else {    \r\n                window.history.pushState(null, null, window.location.pathname + this.buildQuery(this.data.data) + window.location.hash);\r\n            }\r\n            dmx.requestUpdate();\r\n        }\r\n    },\r\n\r\n    buildQuery: function(data) {\r\n        var keys = Object.keys(data);\r\n\r\n        return keys.length ? '?' + keys.reduce(function(query, key) {\r\n            if (query) query += '&';\r\n            query += encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);\r\n            return query;\r\n        }, '') : '';\r\n    },\r\n\r\n    parseQuery: function(query) {\r\n        query = query.replace(/^\\?/, '');\r\n\r\n        return query.split('&').reduce(function(data, part) {\r\n            var p = part.replace(/\\+/g, ' ').split('=');\r\n            if (p[0]) {\r\n                data[decodeURIComponent(p[0])] = decodeURIComponent(p[1] || '');\r\n            }\r\n            return data;\r\n        }, {});\r\n    }\r\n\r\n});\r\n","dmx.Component('cookie-manager', {\r\n\r\n    initialData: {\r\n        data: {}\r\n    },\r\n\r\n    attributes: {},\r\n\r\n    methods: {\r\n        set: function(name, value, options) {\r\n            this.setCookie(name, value, options);\r\n        },\r\n\r\n        remove: function(name, options) {\r\n            options = options || {};\r\n            options.expires = '1970-01-01T00:00:00Z';\r\n            this.setCookie(name, '', options);\r\n        },\r\n\r\n        removeAll: function(options) {\r\n            options = options || {};\r\n            options.expires = '1970-01-01T00:00:00Z';\r\n            Object.keys(this.data.data).forEach(function(name) {\r\n                this.setCookie(name, '', options);\r\n            });\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.cookie = '';\r\n        this.update();\r\n    },\r\n\r\n    update: function() {\r\n        if (this.cookie != document.cookie) {\r\n            this.cookie = document.cookie;\r\n            this.set('data', this.cookie.split(/;\\s*/).reduce(function(data, cookie) {\r\n                var pos = cookie.indexOf('=');\r\n                data[decodeURIComponent(cookie.substr(0, pos))] = decodeURIComponent(cookie.substr(pos + 1));\r\n                return data;\r\n            }, {}));\r\n        }\r\n    },\r\n\r\n    setCookie: function(name, value, options) {\r\n        if (!name || /^(?:expires|max\\-age|path|domain|secure)$/i.test(name)) {\r\n            return false;\r\n        }\r\n\r\n        options = options || {};\r\n        options.path = options.path || '/';\r\n\r\n        // escaping taken from:\r\n        // https://github.com/js-cookie/js-cookie/blob/master/src/js.cookie.js\r\n        name = encodeURIComponent(String(name));\r\n\t\tname = name.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\r\n\t\tname = name.replace(/[\\(\\)]/g, escape);\r\n\r\n        value = encodeURIComponent(String(value));\r\n        value = value.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\r\n\r\n        var cookie = name + '=' + value;\r\n\r\n        if (options.expires) {\r\n            if (typeof options.expires == 'number') {\r\n                options.expires = Date.now() + (options.expires * 86400000);\r\n            }\r\n            cookie += '; expires=' + (new Date(options.expires)).toUTCString();\r\n        }\r\n\r\n        if (options.domain) {\r\n            cookie += '; domain=' + options.domain;\r\n        }\r\n\r\n        if (options.path) {\r\n            cookie += '; path=' + options.path;\r\n        }\r\n\r\n        if (options.secure) {\r\n            cookie += '; secure';\r\n        }\r\n\r\n        document.cookie = cookie;\r\n\r\n        dmx.requestUpdate();\r\n    }\r\n\r\n});\r\n","dmx.Component('local-manager', {\r\n\r\n    initialData: {\r\n        data: {}\r\n    },\r\n\r\n    attributes: {},\r\n\r\n    methods: {\r\n        set: function(key, value) {\r\n            var val = JSON.stringify(value);\r\n            if (val != null) {\r\n                window.localStorage.setItem('dmxState-' + key, val);\r\n            } else {\r\n                window.localStorage.removeItem('dmxState-' + key);\r\n            }\r\n            this.getData();\r\n        },\r\n\r\n        remove: function(key) {\r\n            window.localStorage.removeItem('dmxState-' + key);\r\n            this.getData();\r\n        },\r\n\r\n        removeAll: function() {\r\n            Object.keys(window.localStorage).forEach(function(key) {\r\n                if (key.startsWith('dmxState-')) {\r\n                    window.localStorage.removeItem(key);\r\n                }\r\n            });\r\n            this.getData();\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.getData();\r\n    },\r\n\r\n    getData: function() {\r\n        this.set('data', Object.keys(window.localStorage).reduce(function(data, key) {\r\n            if (key.startsWith('dmxState-')) {\r\n                try {\r\n                    data[key.substr(9)] = JSON.parse(window.localStorage.getItem(key));\r\n                } catch (e) {\r\n                    console.warn('Error parsing JSON: ' + window.localStorage.getItem(key));\r\n                }\r\n            }\r\n\r\n            return data;\r\n        }, {}));\r\n    }\r\n\r\n});\r\n","dmx.Component('session-manager', {\r\n\r\n    initialData: {\r\n        data: {}\r\n    },\r\n\r\n    attributes: {},\r\n\r\n    methods: {\r\n        set: function(key, value) {\r\n            var val = JSON.stringify(value);\r\n            if (val != null) {\r\n                window.sessionStorage.setItem('dmxState-' + key, val);\r\n            } else {\r\n                window.sessionStorage.removeItem('dmxState-' + key);\r\n            }\r\n            this.getData();\r\n        },\r\n\r\n        remove: function(key) {\r\n            window.sessionStorage.removeItem('dmxState-' + key);\r\n            this.getData();\r\n        },\r\n\r\n        removeAll: function() {\r\n            Object.keys(window.sessionStorage).forEach(function(key) {\r\n                if (key.startsWith('dmxState-')) {\r\n                    window.sessionStorage.removeItem(key);\r\n                }\r\n            });\r\n            this.getData();\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.getData();\r\n    },\r\n\r\n    getData: function() {\r\n        this.set('data', Object.keys(window.sessionStorage).reduce(function(data, key) {\r\n            if (key.startsWith('dmxState-')) {\r\n                try {\r\n                    data[key.substr(9)] = JSON.parse(window.sessionStorage.getItem(key));\r\n                } catch (e) {\r\n                    console.warn('Error parsing JSON: ' + window.sessionStorage.getItem(key));\r\n                }\r\n            }\r\n\r\n            return data;\r\n        }, {}));\r\n    }\r\n\r\n});\r\n"]}